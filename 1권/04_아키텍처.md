## MySQL 엔진 아키텍처
### MySQL 서버
1. MySQL 엔진
  - 클라이언트로부터의 접속 및 쿼리 요청을 처리하는 커넥션 핸들러와 SQL 파서 및 전처리기, 쿼리의 최적화된 실행을 위한 옵티마이저로 구성되어 있다.
2. 스토리지 엔진
  - SQL문장을 분석, 최적화
  - 데이터 스토리이지에 데이터를 저장 / 조회
  - InnoDB, MyISAM, Memory로 구성
  - 플러그인 구조로 설계되어, 기능을 추가할 수 있다. 
3. 핸들러 API
  - 쿼리 실행기에서 스토리지 엔진으로 요청을 전달/조절하는 역할
### MySQL 스레딩 구조
1. MySQL서버는 스레드 기반으로 작동한다. 크게 포그라운드 스레드와 백그라운드 스레드로 구분할 수 있다.
  - [ ] 프로세스와 스레드의 차이는?
2. 포그라운드 스레드
  - 데이터를 MySQL의 데이터버퍼나 캐시로부터 가져오며, 버퍼나 캐시에 없는 경우에는 직접 디스크의 인덱스 파일로부터 데이터를 읽어와서 작업을 처리한다.
  - innoDB 테이블의 데이터 버퍼, 캐시를 처리
  - MyISAM의 데이터 버퍼, 캐시, 디스크 쓰기 작업까지 처리
3. 백그라운스 스레드
  - 주로 innoDB의 작업을 처리한다.
    - 인서트 버퍼 병합
    - 로그를 디스크로 기록
    - innoDB 버퍼풀 데이터를 디스크에 기록
    - 데이터를 버퍼로 읽어오기
    - 잠금이나 데드락 모니터링 
### 메모리 할당 및 사용구조
1. 글로벌 메모리 영역 (공유 메모리 영역)
  - 테이블 캐시, innoDB 버퍼풀, innoDB 어댑티드 해시 인덱스, innoDB 리두 로그 버퍼    
2. 로컬 메모리 영역 (스레드별 메모리 영역, 절대 공유되지 않음)
  - 정렬 버퍼, 조인버퍼, 바이너리 로그 캐시, 네트워크 버퍼
### 쿼리 실행 구조
~~~
쿼리 파서 > 전처리기 > 옵티마이저 > 쿼리실행기
~~~
1. 쿼리 파서
   - 쿼리 문장을 토큰(MySQL이 이해할 수 있는 취소단위)으로 분리해 트리 형태의 구조로 만들어내는 작업.
2. 전처리기
   - 쿼리 파서의 결과를 가지고, 쿼리 정합성을 확인한다. 
3. 옵티마이저
   - 쿼리를 저렴한 비용으로 가장 빠르게 처리할 수 있는 방법을 결정한다. DBMS의 두뇌
4. 실행엔진
   - 옵티마이저가 결정한 방법을 수행하도록 핸들러에게 작업을 요청한다.
5. 핸들러
   - 작업을 수행한다. (데이터를 디스크에 저장하고 읽어온다.)
### 쿼리 캐시 : mysql8부터는 삭제됨.
### 스레드풀
1. 내부적으로 스레드 개수를 제한해, CPU가 처리에 집중할 수 있도록 하는 기능 (서버 자원 절약)
### 트랜잭션 지원 메타데이터     
1. 테이블 구조 정보나 스토어드 프로그램 코드 관련 정보를 모두 innoDB의 테이블에 저장한다. (mysql8)
2. 스키마 변경 작업 중간에 mysql 서버가 종료되면 완전 성공 or 완전 실패로 정리된다.
   

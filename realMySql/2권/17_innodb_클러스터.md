## InnoDB 클러스터 아키텍처
- MySQL의 고가용성 실현을 위해 만들어진 여러 구성 요소들의 집합체
  - 그룹복제: 소스 서버의 데이터를 레플리카 서버로 동기화하는 기본적인 복제 역할뿐만 아니라 복제에 참여하는 MYSQL 서버들에 대한 자동화된 맴버십 관리(멤버 추가 및 제거) 역할
  - MySQL 라우터: 애플리케이션 서버와 MySQL 서버 사이에서 동작하는 미들웨어 프로그램. 애플리케이션이 실행한 쿼리를 적절한 MySQL 서버로 전달하는 프록시Proxy 역할
  - MySQL 쉘: MySQL 클라이언트보다 좀 더 확장된 기능을 가진 새로운 클라이언트 프로그램. Admin API를 제공한다.
- 장애 복구 자동화: MySQL 서버에 장애가 발생하면 `그룹 복제`가 감지해서 자동으로 해당 서버를 복제 그룹에서 제외하고, `MySQL 라우터`는 복제 토폴로지 변경을 인지하고 클라이언트의 쿼리가 현재 복제 그룹에서 정상적으로 동작하는 MySQL 서버로만 전달될 수 있게 한다.

### 그룹 복제: Group Replication
- 기존 복제 프레임워크를 기반으로 구현되어 내부적으로 Row 포멧 바이너리 로그와 릴레이 로그, GTID를 사용한다.
- 복제에 참여하는 MySQL 서버들이 하나의 복제 그룹으로 묶인 클러스터 형태를 가지며, 서로 통신하며 양방향으로도 복제할 수 있다.
- 트랜잭션 정보를 전송하고, 과반수 이상의 서버에게 응답을 받으면 최종적으로 commit한다. (합의-Consensus)
- 그룹 복제의 자동화된 기능
  - 그룹 멤버 관리
  - 그룹 단위의 정렬된 트랜잭션 적용 및 트랜잭션 충돌 감지
  - 자동 페일 오버
  - 자동 분산 복구
#### 그룹 복제 아키텍처
- 플러그인 API > 복제 플러그인 > 그룹 통신 시스템 API, 그룹 통신 엔진
#### 그룹 복제 모드
- 싱글 프라이머리 모드: 그룹 내 쓰기를 처리하는 프라이머리 서버가 한 대
- 멀티 프라이머리 모드: 그룹 멤버 전원이 프라이머리로 동작
#### 그룹 멤버 관리
- performane_schema.replication_group_members로 그룹 멤버 목록을 확인할 수 있다.
#### 그룹 복제에서 트랜잭션 처리
- 합의 Consensus: 그룹 멤버들에게 트랜잭션 적용을 제안하고 과반수 이상에게 응답을 받는 행위 
- 인증 Certification: 합의 후 각 멤버가 바이너리 로그에 트랜잭션을 기록하고 최종 커밋을 완료하는 행위. 클라이언트가 커밋 요청에 대한 응답을 받는다.
#### 그룹 복제의 자동 장애 감지 및 대응
- 문제 있는 맴버를 그룹 복제에서 제외한다.
- 주기적으로 멤버 간에 통신 메세지를 주고받으며 서로 상태를 확인한다.
#### 그룹 복제 분산 복구
- 신규 멤버에서 누락된 트랜잭션을 다른 멤버에서 가져와서 복구 프로세스를 자동으로 수행한다. 이를 분산 복구라고 한다.
- 분산 복구에서 가입 멤버가 복구 작업을 위해 선택한 기존 그룹 멤버를 기증자 Donor라고 한다.
- 바이너리 로그 복제 방식: 비동기 복제 방식, 바이너리 로그를 복제해 적용하는 방식
- 원격 클론 방식: 클론 플러그인 사용, innoDB 스토리지 엔진에 저장된 모든 데이터,메타 데이터를 스냅숏으로 가져와 가입 멤버를 재구축하는 방식
#### 그룹 복제 요구사항
- innoDB 스토리지 엔진 사용
- 복제될 모든 테이블이 프라이머리 키를 사용해야 한다.
- 원활한 네트워크 통신 환경
- 바이너리 로그 활성화
- Row 형태의 바이너리 로그 포맷
- 바이너리 로그 체크섬 시스템 변수를 NONE으로 설정해야 함
- log_slave_updates 활성화
- GTID 사용
- server_id 사용
- 복제 메타데이터 저장소 설정
- 멀티 스레드 복제 설정
#### 그룹 복제 제약 사항
- Lock 정보가 공유되지 않는다.
- 복제 필터 기능을 사용할 수 없다.
- 최대 9대 서버까지 구성할 수 있다.
- 멀티 프라이머리 모드일 때, serializable 트랜잭션 격리 수준을 사용할 수 없다. 동시에 실행되는 DDL,DML문은 지원하지 않는다. CASCADE 제약조건이 걸린 테이블은 지원하지 않는다.

## MySQL 셀
- X DevAPI: 관계형 테이터와 문서 기반 데이터를 처리할 수 있게 해주는 API
- AdminAPI: MySQL 서버 설정을 변경하고, InnoDB 클러스터 및 InnoDB 레플리카셋을 구축할 수 있게 해주는 API
## MySQL 라우터
- 애플리케이션 서버로부터 유입된 쿼리 요청을 클러스터 내 적절한 MySQL 서버로 전달하고 MySQL 서버에서 반환된 쿼리 결과를 다시 애플리케이션 서버로 전달하는 Proxy 역할을 한다.

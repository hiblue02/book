## MySQL 서버의 데이터 암호화
###  TDE 암호화 방식
1. 데이터베이스 서버와 디스크 사이의 데이터를 읽고 쓰는 지점에서 암호화/복호화를 수행한다.
2. 그래서 MySQL 내부와 사용자 입장에서는 아무런 차이가 없기 때문에 이러한 암호화 방식을 가리켜 TDE(Transparent Data Encyption)이라고 한다.
3. AES 256비트 알고리즘을 지원한다.
  - 테이블 스페이스키는 AES-256 ECB(electronic codebook) 알고리즘
  - 실제 데이터 파일은 AES-256 CBC(Cipher Block Chaning) 알고리즘
### 2단계 키관리
1. 마스터 키와 테이블스페이스 키로 관리된다.
2. MySQL서버는 외부 키관리 솔류선 도는 디스크의 파일에서 마스터 키를 가져오고, 암호화된 테이블이 생성될때마다, 해당 테이블을 위한 임의의 테이블 스페이크 키를 발급한다. 그리고 MySQL 서버는 마스터 키를 이용해 테이블스페이스 키를 암호화해서 각 테이블의 데이터파일 헤더에 저장한다.
3. 암호화키 변경으로 인한 서버 과부하를 막기 위해 2단계 암호화 방식을 사용한다.
   - 기존 마스터 키로 테이블 스페이스 키를 복호화한 후 새로운 마스터키로 다시 암호화한다. 마스터키가 변경되는 동안 테이블스페이스 키 자체와 데이터파일의 데이터는 변경되지 않는다.
### 암호화 성능
1. 디스크에서 한 번 읽은 데이터 페이지는 복호화되어 innoDB의 버퍼풀에 적재된다. 버퍼풀에 없는 데이터를 읽거나, 암호화된 테이블이 변경되면 암복호화 지연이 발생할 수 있다.
2. AES 알고리즘은 암호화 결과의 용량이 더 커질 수 있다. 그러나 데이터페이지는 암호화 결과와 평문의 결과가 같은 크기다.
### 암호화와 복제
1. 소스 서버와 레플리카 서버는 암호화된 값이 다르다. 각자의 마스터키와 테이블스페이스키를 관리한다.
## 테이블 암호화
1. 테이블 생성 구문에 `ENCRPYTION='Y'` 옵션을 추가한다.
2. 응용 프로그램에서 직접 암호화해서 MySQL 서버에 저장ㅎ는 경우, 인덱스의 기능을 100% 활용할 수 없다. 
  (정렬 기능 사용 못 함. 테이블 암호화 쓰면 정렬기능 쓸 수 있음. 오호!!)
## 언두 로그 및 리두 로그 암호화
1. 테이블 암호화를 적용해도 리두 로그, 언두 로그 그리고 복제를 위한 바이너리 로그에는 평문으로 저장된다.
2. `innodb_undo_log_encrypt`, `innodb_redo_log_encrypt` 시스템 변수로 리두,언두 로그 암호화를 설정할 수 있다.
3. 리두 로그, 언두 로그를 위한 각각의 프라이빗 키가 발급되고, 해당 프라이빗 키는 마스터 키로 암호화되어 리부 로그 파일과 언두 로그 파일의 헤더에 저장되는 것이다.
## 바이너리 로그 암호화
1. 바이너리 로그와 릴레이 로그 파일 암호화 기능은 디스크에 저장된 로그 파일에 대한 암호화만 담당하고, MySQL 서버의 메모리 내부 도는 소스 서버와 레플리카 서버 간의 네트워크 구간에서 로그 데이터를 암호화하지 않는다.
2. 바이너리 로그와 릴레이 로그 파일의 데이터는 파일 키로 암호화해서 디스크로 저장하고, 파일 키는 바이너리 로그 암호화 키로 암호화해서 각 파일 헤더에 저장된다. 

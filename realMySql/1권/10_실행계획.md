## 통계정보
### 인덱스 통계정보
- mysql 5.6 버전 부터는 테이블의 통계 정보를 innodb_table_stats 테이블로 관리할 수 있게 개선됬다. 
- ~~~SQL
  SELECT *
  FROM INNODB_INDEX_STATS
  WHERE DATABASE_NAME = 'employees'
  AND TABLE_NAME = 'employees'; 
  ~~~
- 통계정보를 자동으로 수집할지 여부도 테이블을 생성할 때 `STATS_AUTO_RECALC` 옵션을 이용해 테이블 단위로 조정할 수 있다.
- 영구적인 통계정보를 사용할 때, 더 정확한 통계정보를 수집하고자 한다면 `INNODB_STATS_PERSISTENT_SAMPLE_PAGES` 시스템 변수에 높은 값을 설정하면 된다.

### 히스토그램
- 히스토그램 정보는 칼럼 단위로 관리되는데, 이는 자동으로 수집되지 않고 `ANALYZE TABLE ... UPDATE HISTOGRAM` 명령을 실행해 수동으로 수집 및 관리된다.
- 히스토그램은 특정 칼럼이 가지는 모든 값에 대한 분포도 정보를 가지지는 않지만 각 범위(버킷)별로 레코드의 건수와 유니크한 값의 개수 정보를 가지기 때문에 훨씬 정확한 예측을 할 수 있다. 
- ~~~SQL
  ANALYZE TABLE EMPLOYEES.EMPLOYEES
  UPDATE HISTOGRAM ON GENDER, HIRE_DATE;

  SELECT *
  FROM COLUMN_STATISTICS
  WHERE SCHEMA_NAME='EMPLOYEES'
  AND TABLE_NAME='EMPLOYEES'
  ~~~
- MYSQL8.0에서는 2종류의 히스토그램을 지원한다.
    - singleton
        - 칼럼값 개별로 레코드 건수를 관리 (value-based, 도수 분포)
        - 각 버킷이 칼럼의 값과 발생빈도의 비율을 갖는다. 
    - equi-height
        - 칼럼값의 범위를 균등한 개수로 구분해서 관리. (height-balanced)
        - 각 버킷이 범위 시작 값과 마지막 값, 그리고 발생 빈도율과 각 버킷에 포함된 유니크한 값의 개수 등 4개의 값을 가진다. 
### 코스트 모델
- mysql 8.0 서버의 코스트 모델은 다음 2개 테이블에 저장돼있는 설정값을 사용하는데, 두 테이블 모두 mysql DB에 있다.
    - server_cost : 인덱스를 찾고 레코드를 비교하고 임시 테이블 처리에 대한 비용 관리
        - io_block_read_cost : 디스크 데이터 페이지 읽기
        - memeory_block_read_cost : 메모리 데이터 페이지 읽기 
    - engine_cost : 레코드를 가진 데이터 페이지를 가져오는 데 필요한 비용 관리
        - disk_temptable_create_cost : 디스크 임시 테이블 생성
        - disk_temptable_row_cost : 디스크 임시 테이블 레코드 읽기
        - key_compare_cost : 인덱스 키 비교
        - memory_temptable_create_cost : 메모리 임시 테이블 생성
        - memory_temptable_row_cost : 메모리 임시 테이블의 레코드 읽기
        - row_evaluate_cost : 레코드 비교
## 실행 계획 확인
- ~~~SQL
  EXPLAIN
  SELECT *
  FROM EMPLOYEES E INNER JOIN SALARIES S ON S.EMP_NO = E.EMP_NO
  WHERE FIRST_NAME='ABC';
  ~~~
- `EXPLAIN ANALYZE` **실제 쿼리를 실행**하고 쿼리의 실행 계획과 단계별 소요된 시간 정보를 확인할 수 있는 기능, 
    - TREE 포맷의 실행계획에서 들여쓰기는 호출 순서를 의미하며, 실제 실행 순서는 다음 기준으로 읽으면 된다.
        - 들여쓰기가 같은 레벨에서는 상단에 위치한 라인이 먼저 실행
        - 들여쓰기가 다른 레벨에서는 가장 안쪽에 위치한 라인이 먼저 실행
    - 단계별로 실제 소요된 시간`actual time`, 처리한 레코드 건수`rows`, 반복 횟수`loops`가 표시된다.
- ~~~sql
  mysql> EXPLAIN SELECT Name FROM country WHERE Code Like 'A%';
  +----+-------------+---------+------------+-------+---------------+---------+---------+------+------+----------+-------------+
  | id | select_type | table   | partitions | type  | possible_keys | key     | key_len | ref  | rows | filtered | Extra       |
  +----+-------------+---------+------------+-------+---------------+---------+---------+------+------+----------+-------------+
  |  1 | SIMPLE      | country | NULL       | range | PRIMARY       | PRIMARY | 12      | NULL |   17 |   100.00 | Using where |
  +----+-------------+---------+------------+-------+---------------+---------+---------+------+------+----------+-------------+
  ~~~
